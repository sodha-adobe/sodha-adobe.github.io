
<!doctype html>
<html lang="en">

<head>
	<script>
		/**
* @description ttMETA replacement for Web SDK; 
*         uses alloy.js monitoring hooks to extract meta data from response tokens
* @usage: initialize before Web SDK calls; 
*         run `__alloyMeta.get()` to get meta data from experiences; 
*         customize namespace `(window, "ttMETA")` to use as `ttMETA.get()`
*         `__alloyMeta.clear()` to reset meta data in SPA if necessary
*         `__alloyMeta.processFetchData()` and `__alloyMeta.processDisplayData()` process monitoring hooks data
* @version 0.0.2
* @support ustymenk@adobe.com
*/
((global, metaStore) => {
  let fetchedExperiences = [],
    displayedExperiences = [];
  const add = (uniqueId, obj) => {
    const existingIndex = fetchedExperiences.findIndex(item => item.uniqueId === uniqueId);
    if (existingIndex !== -1) {
      fetchedExperiences[existingIndex].data["Modifications"].push(obj["Modifications"]);
    } else {
      fetchedExperiences.push({
        uniqueId,
        data: obj
      });
    }
  };
  const mark = uniqueId => {
    const entry = fetchedExperiences.find(item => item.uniqueId === uniqueId);
    if (entry) {
      displayedExperiences.push({
        ...entry
      });
    }
  };
  global[metaStore] = {
    get: () => {
      let result = [];
      displayedExperiences.forEach(obj => {
        result.push(obj.data);
      });
      return result;
    },
    clear: () => {
      fetchedExperiences = [];
      displayedExperiences = [];
    },
    processFetchData: data => {
      let handles = data?.parsedBody?.handle;
      if (handles && handles.length) {
        handles.forEach(handle => {
          if (handle.type === "personalization:decisions") {
            let payloadList = handle.payload;
            if (payloadList && payloadList.length) {
              payloadList.forEach(payload => {
                let items = payload.items;
                if (items && items.length) {
                  items.forEach(item => {
                    let meta = item.meta;
                    if (meta["activity.id"] && meta["experience.id"]) {
                      const uniqueId = meta["activity.id"] + ":" + meta["experience.id"];
                      add(uniqueId, {
                        "ActivityID": meta["activity.id"] || "",
                        "ActivityName": meta["activity.name"] || "",
                        "ExperienceID": meta["experience.id"] || "",
                        "ExperienceName": meta["experience.name"] || "",
                        "OfferID": meta["offer.id"] || "",
                        "OfferName": meta["offer.name"] || "",
                        "Scope": payload?.scope || "",
                        "Modifications": [{
                          "Modification": item?.data?.type || "",
                          "Mod Selector": item?.data?.selector || ""
                        }]
                      });
                    }
                  });
                }
              });
            }
          }
        });
      }
    },
    processDisplayData: data => {
      let events = data?.payload?.events;
      if (events && events.length) {
        events.forEach(event => {
          let propositions = event?.xdm?._experience?.decisioning?.propositions;
          if (propositions && propositions.length) {
            propositions.forEach(proposition => {
              const scopeDetails = proposition?.scopeDetails;
              const uniqueId = scopeDetails?.activity?.id + ":" + scopeDetails?.experience?.id;
              mark(uniqueId);
            });
          }
        });
      }
    }
  };
})(window, "__alloyMeta");
window.__alloyMonitors = window.__alloyMonitors || [];
window.__alloyMonitors.push({
  onBeforeNetworkRequest(data) {
    __alloyMeta.processDisplayData(data);
  },
  onNetworkResponse(data) {
    __alloyMeta.processFetchData(data);
  }
});
</script>
	<title>Launch, by Adobe: Sample HTML Page</title>


	<!-- Adobe: Start Scripts-->
	<!--/Preconnect and DNS-Prefetch-->
	<!--Data Layer to enable rich data collection and targeting-->
	<!--/Data Layer-->
<script src="project.js"></script>
	<script>
		let pageName = document.location.pathname.split('/')[1];
		window.adobeDataLayer = window.adobeDataLayer || [];
		window.adobeDataLayer.push({
			"event": "Page Loaded",
			"xdm": {
				"web": {
					"webPageDetails": {
						"siteSection": "home", //home is for the root directory
						"language": "en",
						"pageType": "portfolio-home-page", //the template name or id
						"pageName": pageName,
						"ErrorPage": "", // incase of 404 error page only
						"publishDate": "05/04/2023",
						"FPID":'566ea316-c052-4553-928b-9ae3e75cc71d'
					},
					"category": {
						"siteSection1": "",
						"siteSection2": "",
						"siteSection3": "",


					}
				}
			}
		});
	</script>
	<!--Launch Header Embed Code: REPLACE THE NEXT LINE WITH THE EMBED CODE FROM YOUR OWN DEVELOPMENT ENVIRONMENT-->
	<script src="https://assets.adobedtm.com/22bf1a13013f/0cef31991912/launch-c0f99a84365e-development.min.js"
		async></script>
	<!--/Launch Header Embed Code-->
	<!-- Adobe: End Scripts-->
</head>

<body>
	<h1>Launch, by Adobe: Sample HTML Page</h1>
	<p>This is a very simple page to demonstrate basic implementation concepts of websdk</p>
	<p>See <a href="https://experienceleague.adobe.com/docs/experience-platform/edge/home.html?lang=en">Implementing the
			websdk in Websites with Launch</a> for the complete tutorial</p>
	<button>
		Hover on it and Click!
	</button>
	</br>
	<p> Products </p>
	<a class="cmp-cartadd__action-link" href="#" id="cartadd-2122a9f81a-cta-6b28b693be"
		data-cmp-data-layer="{&quot;cartadd-2122a9f81a-cta-6b28b693be&quot;:{&quot;@type&quot;:&quot;wknd/components/cartadd/cta&quot;,&quot;dc:title&quot;:&quot;Add To Cart&quot;,&quot;xdm:linkURL&quot;:&quot;/us/en/adventures.html&quot;}}"
		data-cmp-clickable="" onclick="(e)=>{window.adobeDataLayer = window.adobeDataLayer || []; window.adobeDataLayer.push(e);}">Add to Cart</a>
	</br>
	<a class="cmp-cartremove__action-link" href="#" id="cartremove-2122a9f81a-cta-6b28b693bd"
		data-cmp-data-layer="{&quot;cartremove-2122a9f81a-cta-6b28b693bd&quot;:{&quot;@type&quot;:&quot;wknd/components/cartadd/cta&quot;,&quot;dc:title&quot;:&quot;Remove From Cart&quot;,&quot;xdm:linkURL&quot;:&quot;/us/en/adventures.html&quot;}}"
		data-cmp-clickable="">Remove From Cart</a>
	</br>
	<a class="cmp-checkout__action-link" href="#" id="checkout-2122a9f81b-cta-6b28b693be"
		data-cmp-data-layer="{&quot;checkout-2122a9f81b-cta-6b28b693be&quot;:{&quot;@type&quot;:&quot;wknd/components/checkout/cta&quot;,&quot;dc:title&quot;:&quot;Checkout&quot;,&quot;xdm:linkURL&quot;:&quot;/us/en/adventures.html&quot;}}"
		data-cmp-clickable="">Checkout</a>
	</br>
<a class="ink" href="about.html">About Websdk Click Here to navigate to page</a>
<br>
<h1></h1>

</body>

</html>
